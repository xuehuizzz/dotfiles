# alias duckdb="docker run --rm -it -v \$(pwd):/data -w /data duckdb-cli:latest"

# syntax=docker/dockerfile:1
FROM debian:bookworm-slim

ENV DUCKDB_DIR=/opt/duckdb
ENV DUCKDB_EXTENSION_DIRECTORY=${DUCKDB_DIR}/extensions
ENV DEBIAN_FRONTEND=noninteractive
ENV PATH="${DUCKDB_DIR}/bin:${PATH}"

# 安装依赖、创建目录、下载 DuckDB CLI 并安装扩展
RUN apt-get update && \
    apt-get install -y --no-install-recommends ca-certificates curl unzip && \
    mkdir -p ${DUCKDB_DIR}/bin ${DUCKDB_DIR}/extensions && \
    curl -fsSL -o /tmp/duckdb.zip "https://github.com/duckdb/duckdb/releases/latest/download/duckdb_cli-linux-amd64.zip" && \
    unzip /tmp/duckdb.zip -d /tmp && \
    mv /tmp/duckdb ${DUCKDB_DIR}/bin/duckdb && \
    chmod +x ${DUCKDB_DIR}/bin/duckdb && \
    rm -rf /tmp/duckdb.zip /var/lib/apt/lists/* && \
    # 安装并加载扩展到默认数据库
    duckdb -c "INSTALL excel; INSTALL json; INSTALL parquet; LOAD excel; LOAD json; LOAD parquet;"

# 默认入口命令
ENTRYPOINT ["duckdb"]

